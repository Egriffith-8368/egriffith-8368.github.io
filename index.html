<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My ChatGPT</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Password Gate Modal -->
  <div id="gate" class="gate hidden">
    <div class="gate-card">
      <h2>Welcome</h2>
      <p id="gateMessage">Create a simple password to unlock this app. This password also gates access to your saved chats.</p>
      <div class="gate-row">
        <input id="gateInput" type="password" placeholder="Enter password" />
        <button id="gateBtn">Continue</button>
      </div>
      <p class="gate-hint" id="gateHint"></p>
    </div>
  </div>

  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <button id="newChatBtn" class="btn btn-primary">+ New chat</button>
      </div>

      <div class="sidebar-section">
        <h4>Recent (3)</h4>
        <ul id="recentList" class="conv-list"></ul>
      </div>

      <div class="sidebar-section">
        <h4>Settings</h4>
        <div class="setting-row">
          <label for="apiKeyInput">OpenAI API key</label>
          <div class="inline-row">
            <input id="apiKeyInput" type="password" placeholder="sk-..." />
            <button id="saveKeyBtn" class="btn btn-secondary">Save</button>
          </div>
          <small class="muted">Stored in your browser's localStorage, gated by your password.</small>
        </div>
        <div class="setting-row">
          <label for="modelSelect">Model</label>
          <select id="modelSelect">
            <option value="gpt-4o-mini">gpt-4o-mini</option>
            <option value="gpt-4o">gpt-4o</option>
            <option value="gpt-4.1-mini">gpt-4.1-mini</option>
            <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
          </select>
        </div>
        <div class="setting-row">
          <button id="resetPasswordBtn" class="btn btn-danger">Reset password</button>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="topbar">
        <div class="title-wrap">
          <h1 class="title">My ChatGPT</h1>
          <span id="threadTitle" class="thread-title">New chat</span>
        </div>
        <div class="topbar-right">
          <button id="exportBtn" class="btn btn-secondary">Export chat</button>
          <button id="clearBtn" class="btn btn-ghost">Clear</button>
        </div>
      </header>

      <section id="chat" class="chat"></section>

      <footer class="composer">
        <textarea id="userInput" rows="1" placeholder="Message... (Shift+Enter = newline)"></textarea>
        <button id="sendBtn" class="btn btn-primary">Send</button>
      </footer>
    </main>
  </div>

  <template id="msgTemplate">
    <div class="bubble">
      <div class="avatar" data-role="role"></div>
      <div class="content">
        <div class="meta">
          <span class="role" data-field="roleLabel">Assistant</span>
          <span class="time" data-field="time"></span>
        </div>
        <div class="text" data-field="text"></div>
      </div>
    </div>
  </template>

  <script src="script.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // Minimal iPad-friendly fallback to allow testing if the main script has errors.
  const gateBtn = document.getElementById('gateBtn');
  const gateInput = document.getElementById('gateInput');
  const gateHint = document.getElementById('gateHint');
  const gateEl = document.getElementById('gate');
  const appEl = document.querySelector('.app');

  function simpleHash(s){
    // small deterministic numeric hash (not secure â€” OK for gate-only UX)
    let h = 5381;
    for(let i=0;i<s.length;i++) h = ((h<<5)+h) + s.charCodeAt(i);
    return String(h >>> 0);
  }

  gateBtn?.addEventListener('click', function(e){
    try{
      e.preventDefault();
      const pass = (gateInput?.value || '').trim();
      if(!pass){ if(gateHint) gateHint.textContent = 'Password required'; return; }
      // set password markers in localStorage so the normal script can pick them up later
      try{
        localStorage.setItem('chatapp.password.hash', simpleHash(pass));
        localStorage.setItem('chatapp.password.set', '1');
      } catch(err){
        if(gateHint) gateHint.textContent = 'Could not save password (storage blocked).';
        return;
      }
      // hide gate UI
      if(appEl) { appEl.style.filter = 'none'; appEl.style.pointerEvents = 'auto'; }
      if(gateEl) gateEl.classList.add('hidden');
      if(gateHint) gateHint.textContent = '';
    }catch(err){
      if(gateHint) gateHint.textContent = String(err.message || err);
    }
  });
});
</script>
  


</body>
</html>
